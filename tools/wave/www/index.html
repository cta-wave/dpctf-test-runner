<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Web Media API Snapshot Test Suite</title>
    <link rel="stylesheet" href="css/bulma-0.7.5/bulma.min.css" />
    <link rel="stylesheet" href="css/fontawesome.min.css" />
    <script src="lib/keycodes.js"></script>
    <script src="lib/wave-service.js"></script>
    <script src="lib/davidshimjs/qrcode.js"></script>
    <script src="lib/hbbtv.js"></script>
  </head>

  <dialog id="eulaDialog">
    <div class=".modal-close">
      <form method="dialog">
          <p>
          <b>WAVE TEST MATERIAL USER AGREEMENT</b>
          <br/><br/>
          This user agreement (the “License ”) is entered into and is effective as of the date of content download between you (“Test Material User”) and the Consumer Technology Association (CTA)® located at 1919 South Eads Street, Arlington, VA 22202.
          <br/><br/>
          <b>WHEREAS</b>, CTA Web Application Video Ecosystem (“WAVE”) is an industry project on voluntary consensus technical standards and best practices for commercial internet video interoperability, organized and sponsored by CTA. The WAVE project provides encoded, digital entertainment audio and video content which may be used for testing purposes to verify conformance to WAVE Standards (“Test Material”).
          <br/><br/>
          <b>TERMS:</b>
          <br/><br/>
          1.  <u>License</u>. In consideration of the terms set forth below, CTA grants Test Material User license to use the Test Material for WAVE testing purposes subject to <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 Public Licensure</a> (“CCA 4.0”).  Test Material User receives no patent, trademark or other similar rights in the Test Material under this License.
          <br/><br/>
          2. <u>Media Format.</u> The license granted includes the right to change the media format of the Test Material.  
          <br/><br/>
          3.  <u>No Additional Restrictions.</u> Test Material User may not apply legal terms or technological measures to the Test Material or any derivative works that legally or practically restrict other users from doing anything that would otherwise be permitted if they licensed the Test Material directly from CTA. 
          <br/><br/>
          4.	<u>Ownership.</u> For purposes of this public license, Test Material User shall make no claim as to any ownership interest in the Test Materials or any portion thereof.
          <br/><br/>
          5.  <u>No Endorsement.</u>  Nothing in this License constitutes or may be construed as permission to assert or imply that Test Material Users are, or that Test Material Users’ use of the Test Material is, connected with, or sponsored, endorsed, or granted official status by, CTA or others designated to receive attribution.
          <br/><br/>
          6. <u>Attribution.</u>  When using the Test Material, Test Material Users must comply with CCA 4.0 Section 3. Test Material User must not in any way suggest that CTA endorses Test Material User or its use of the Test Material.
          <br/><br/>
          7.  <u>Disclaimer of Warranties/Limitation of Liability.</u>
          <br/><br/>
          a.	CTA offers the Test Material as-is and as-available and makes no representations or warranties of any kind concerning the Test Material, whether express, implied, statutory, or other. This includes, without limitation, warranties of title, merchantability, fitness for a particular purpose, non-infringement, absence of latent or other defects, accuracy, or the presence or absence of errors, whether or not known or discoverable. 
          <br/><br/>
          b.	To the extent possible, in no event will CTA be liable to Test Material User on any legal theory (including, without limitation, negligence) or otherwise for any direct, special, indirect, incidental, consequential, punitive, exemplary, or other losses, costs, expenses, or damages arising out of this License or use of the Test Material, even if CTA has been advised of the possibility of such losses, costs, expenses, or damages. 
          <br/><br/>
          c.	The disclaimer of warranties and limitation of liability provided above shall be interpreted in a manner that, to the extent possible, most closely approximates an absolute disclaimer and waiver of all liability.
          <br/>
          d.	Indemnity.  Test Material User shall indemnify and hold CTA harmless against and from any third-party claim resulting from Test Material User’s use of the Test Materials. 
          <br/><br/>
          e.	IN NO EVENT SHALL CTA BE LIABLE TO COMPANY FOR AN AMOUNT IN EXCESS OF THE AMOUNT OF FEES PAID BY COMPANY UNDER THIS AGREEMENT FOR THE CALENDAR YEAR IN QUESTION BASED ON ANY CLAIM ARISING OUT OF OR RELATED TO THIS AGREEMENT, REGARDLESS OF WHETHER THE CLAIM IS BASED ON WARRANTY, CONTRACT, TORT OR ANY OTHER LEGAL THEORY.
          <br/><br/>
          8.  <u>Other Terms and Conditions.</u>
          <br/><br/>
          a.	CTA shall not be bound by any additional or different terms or conditions communicated by Test Material User unless expressly agreed in writing.
          <br/><br/>
          b.	CCA 4.0 as integrated into this License contains the complete and exclusive statement of the agreement between the parties and supersedes all prior agreements and understandings (whether oral or written) between the parties.  This License may not be modified or amended except in a writing executed by both parties that refers to this License.  
          <br/><br/>
          9.  <u>Interpretation.</u>
          <br/><br/>
          a.	To the extent possible, if any provision of this License is deemed unenforceable, it shall be automatically reformed to the minimum extent necessary to make it enforceable. If the provision cannot be reformed, it shall be severed from this License without affecting the enforceability of the remaining terms and conditions.
          <br/><br/>
          b.	No term or condition of this License will be waived and no failure to comply consented to unless expressly agreed to by CTA in writing.
          <br/><br/>
          c.	Nothing in this License constitutes or may be interpreted as a limitation upon, or waiver of, any privileges and immunities that apply to CTA or Test Material User, including from the legal processes of any jurisdiction or authority.
          <br/><br/>
          10.  <u>Governing Law.</u> This Agreement and all its rights and obligations of the parties relating hereto will be governed by and construed in accordance with the internal laws of the Commonwealth of Virginia without giving effect to any conflicts of law rules that would cause the application of the laws of any other jurisdiction. Any controversy or claim arising out of or relating to this Agreement or the breach thereof (except for an action for injunctive relief) may be resolved by arbitration held in Arlington County, Commonwealth of Virginia, in accordance with Rules of the American Arbitration Association in effect at the time the arbitration is initiated, and judgment upon the award rendered by the arbitrators may be entered in any court jurisdiction thereof, Company agrees to submit to the exclusive jurisdiction of the State and Federal courts in the Commonwealth of Virginia.
          <br/><br/>
          11.  <u>Miscellaneous.</u>  The parties to this Agreement are independent contractors with respect to each other, and nothing in this Agreement shall create any association, partnership, joint venture or agency relationship between the parties.  
          </p>
          <div>
            <button id="acceptEula" value="default">I accept</button>
          </div>
      </form>
    </div>
  </dialog>

  <body>
    <section class="section">
      <div class="container">
        <img
          style="max-width: 300px; margin-bottom: 30px; margin-left: -15px;"
          src="res/wavelogo_2016.jpg"
          alt="WAVE (Web Application Video Ecosystem) Project Logo"
        />

        <h1 class="title is-spaced">
          WAVE DPCTF Test Suite
        </h1>
        <p class="subtitle">
          <a target="_blank" href="https://github.com/cta-wave/dpctf-deploy">GitHub</a> - 
          <a target="_blank" href="https://cdn.cta.tech/cta/media/media/resources/standards/pdfs/cta-5003-final.pdf">DPCTF Specification</a>
        </p>
      </div>

      <div class="container" style="margin-top: 2em;">
        <h2 class="title is-5">
          New test session
        </h2>
        <div class="columns is-vcentered" style="margin-top: 20px;">
          <div class="column is-narrow">
            <div
              id="qr-code"
              style="
                width: 256px;
                height: 256px;
                padding: 5px;
                border: 1px gray solid;
                border-radius: 3px;
              "
            ></div>
          </div>
          <div class="column">
            <table style="margin-bottom: 1.5em;">
              <tr>
                <td class="has-text-weight-bold" style="padding-right: 1rem;">
                  Token:
                </td>
                <td id="session-token" class="is-family-monospace"></td>
              </tr>
              <tr>
                <td class="has-text-weight-bold" style="padding-right: 1rem;">
                  Expires:
                </td>
                <td id="expiary-date"></td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <p class="is-size-7">(Session start revokes expiration.)</p>
                </td>
              </tr>
            </table>

            <p style="max-width: 32rem; margin-bottom: 1rem;">
              Configure a new session on a second device by scanning the
              QR-Code, or click the button:
            </p>
            <div
              class="button"
              style="margin-bottom: 1rem;"
              id="configure-button"
            >
              <span class="icon"><i class="fas fa-sliders-h"></i></span>
              <span>Configure Session</span>
            </div>
            <p style="max-width: 32rem;">
              The tests will start running in this window, as soon as the
              session is started from the configuration view.
            </p>
          </div>
        </div>
      </div>

      <div class="container" style="margin-top: 2em;">
        <h2 class="title is-5">
          Resume running session
        </h2>
        <article
          id="unknown_token_error"
          style="max-width: 30em; display: none;"
          class="message is-danger"
        >
          <div class="message-body">
            Unknown token
          </div>
        </article>
        <div class="columns is-vcentered">
          <div id="resume_token" class="column is-narrow"></div>
          <div class="button-group column">
            <button
              id="resume-button"
              class="button is-success tabbable"
              type="submit"
              data-uid="100"
              autofocus
            >
              <span class="icon"><i class="fas fa-redo"></i></span>
              <span>Resume</span>
            </button>
          </div>
        </div>
      </div>
    </section>

    <dialog id="eulaDialog">
      <form method="dialog">
        <p>
          <b>WAVE TEST MATERIAL USER AGREEMENT</b>
          <br /><br />
          This user agreement (the “License ”) is entered into and is effective as of the date of content download between
          you (“Test Material User”) and the Consumer Technology Association (CTA)® located at 1919 South Eads Street,
          Arlington, VA 22202.
          <br /><br />
          <b>WHEREAS</b>, CTA Web Application Video Ecosystem (“WAVE”) is an industry project on voluntary consensus
          technical standards and best practices for commercial internet video interoperability, organized and sponsored by
          CTA. The WAVE project provides encoded, digital entertainment audio and video content which may be used for
          testing purposes to verify conformance to WAVE Standards (“Test Material”).
          <br /><br />
          <b>TERMS:</b>
          <br /><br />
          1. <u>License</u>. In consideration of the terms set forth below, CTA grants Test Material User license to use the
          Test Material for WAVE testing purposes subject to <a href="https://creativecommons.org/licenses/by/4.0/">Creative
            Commons Attribution 4.0 Public Licensure</a> (“CCA 4.0”). Test Material User receives no patent, trademark or
          other similar rights in the Test Material under this License.
          <br /><br />
          2. <u>Media Format.</u> The license granted includes the right to change the media format of the Test Material.
          <br /><br />
          3. <u>No Additional Restrictions.</u> Test Material User may not apply legal terms or technological measures to
          the Test Material or any derivative works that legally or practically restrict other users from doing anything
          that would otherwise be permitted if they licensed the Test Material directly from CTA.
          <br /><br />
          4. <u>Ownership.</u> For purposes of this public license, Test Material User shall make no claim as to any
          ownership interest in the Test Materials or any portion thereof.
          <br /><br />
          5. <u>No Endorsement.</u> Nothing in this License constitutes or may be construed as permission to assert or imply
          that Test Material Users are, or that Test Material Users’ use of the Test Material is, connected with, or
          sponsored, endorsed, or granted official status by, CTA or others designated to receive attribution.
          <br /><br />
          6. <u>Attribution.</u> When using the Test Material, Test Material Users must comply with CCA 4.0 Section 3. Test
          Material User must not in any way suggest that CTA endorses Test Material User or its use of the Test Material.
          <br /><br />
          7. <u>Disclaimer of Warranties/Limitation of Liability.</u>
          <br /><br />
          a. CTA offers the Test Material as-is and as-available and makes no representations or warranties of any kind
          concerning the Test Material, whether express, implied, statutory, or other. This includes, without limitation,
          warranties of title, merchantability, fitness for a particular purpose, non-infringement, absence of latent or
          other defects, accuracy, or the presence or absence of errors, whether or not known or discoverable.
          <br /><br />
          b. To the extent possible, in no event will CTA be liable to Test Material User on any legal theory (including,
          without limitation, negligence) or otherwise for any direct, special, indirect, incidental, consequential,
          punitive, exemplary, or other losses, costs, expenses, or damages arising out of this License or use of the Test
          Material, even if CTA has been advised of the possibility of such losses, costs, expenses, or damages.
          <br /><br />
          c. The disclaimer of warranties and limitation of liability provided above shall be interpreted in a manner that,
          to the extent possible, most closely approximates an absolute disclaimer and waiver of all liability.
          <br />
          d. Indemnity. Test Material User shall indemnify and hold CTA harmless against and from any third-party claim
          resulting from Test Material User’s use of the Test Materials.
          <br /><br />
          e. IN NO EVENT SHALL CTA BE LIABLE TO COMPANY FOR AN AMOUNT IN EXCESS OF THE AMOUNT OF FEES PAID BY COMPANY UNDER
          THIS AGREEMENT FOR THE CALENDAR YEAR IN QUESTION BASED ON ANY CLAIM ARISING OUT OF OR RELATED TO THIS AGREEMENT,
          REGARDLESS OF WHETHER THE CLAIM IS BASED ON WARRANTY, CONTRACT, TORT OR ANY OTHER LEGAL THEORY.
          <br /><br />
          8. <u>Other Terms and Conditions.</u>
          <br /><br />
          a. CTA shall not be bound by any additional or different terms or conditions communicated by Test Material User
          unless expressly agreed in writing.
          <br /><br />
          b. CCA 4.0 as integrated into this License contains the complete and exclusive statement of the agreement between
          the parties and supersedes all prior agreements and understandings (whether oral or written) between the parties.
          This License may not be modified or amended except in a writing executed by both parties that refers to this
          License.
          <br /><br />
          9. <u>Interpretation.</u>
          <br /><br />
          a. To the extent possible, if any provision of this License is deemed unenforceable, it shall be automatically
          reformed to the minimum extent necessary to make it enforceable. If the provision cannot be reformed, it shall be
          severed from this License without affecting the enforceability of the remaining terms and conditions.
          <br /><br />
          b. No term or condition of this License will be waived and no failure to comply consented to unless expressly
          agreed to by CTA in writing.
          <br /><br />
          c. Nothing in this License constitutes or may be interpreted as a limitation upon, or waiver of, any privileges
          and immunities that apply to CTA or Test Material User, including from the legal processes of any jurisdiction or
          authority.
          <br /><br />
          10. <u>Governing Law.</u> This Agreement and all its rights and obligations of the parties relating hereto will be
          governed by and construed in accordance with the internal laws of the Commonwealth of Virginia without giving
          effect to any conflicts of law rules that would cause the application of the laws of any other jurisdiction. Any
          controversy or claim arising out of or relating to this Agreement or the breach thereof (except for an action for
          injunctive relief) may be resolved by arbitration held in Arlington County, Commonwealth of Virginia, in
          accordance with Rules of the American Arbitration Association in effect at the time the arbitration is initiated,
          and judgment upon the award rendered by the arbitrators may be entered in any court jurisdiction thereof, Company
          agrees to submit to the exclusive jurisdiction of the State and Federal courts in the Commonwealth of Virginia.
          <br /><br />
          11. <u>Miscellaneous.</u> The parties to this Agreement are independent contractors with respect to each other,
          and nothing in this Agreement shall create any association, partnership, joint venture or agency relationship
          between the parties.
          <br /><br />
        </p>
        <div>
          <button id="acceptEula" value="default">I accept</button>
        </div>
      </form>
    </dialog>

    <script>
      var selectedTabbable = -1;

      function removeClass(element, className) {
        var elementClass = element.className;
        var index = elementClass.indexOf(className);
        if (index !== -1) {
          element.className = elementClass.replace(className, "");
        }
      }

      function addClass(element, className) {
        element.className += " " + className;
      }

      function skipFocus(steps) {
        var tabbables = document.getElementsByClassName("tabbable");
        if (selectedTabbable === -1) {
          selectedTabbable = 0;
        } else {
          removeClass(tabbables[selectedTabbable], "focused");
          selectedTabbable += steps;
        }

        if (selectedTabbable >= tabbables.length) {
          selectedTabbable = 0;
        }

        if (selectedTabbable < 0) {
          selectedTabbable = tabbables.length - 1;
        }

        tabbables[selectedTabbable].focus();
        addClass(tabbables[selectedTabbable], "focused");
      }

      function focusNext() {
        skipFocus(1);
      }

      function focusPrevious() {
        skipFocus(-1);
      }

      // Resume
      var resumeToken = "";
      var cookies = document.cookie.split(";");
      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i];
        if (cookie.split("=")[0].replace(/ /g, "") === "resume_token") {
          resumeToken = cookie.split("=")[1];
          break;
        }
      }
      if (!resumeToken) resumeToken = "";

      var resumeButton = document.getElementById("resume-button");

      var tokenText = document.getElementById("resume_token");
      if (resumeToken) {
        tokenText.innerText = "Last session: " + resumeToken;
      } else {
        tokenText.innerText = "No recent session.";
        resumeButton.setAttribute("disabled", "");
      }
      var unknownTokenError = document.getElementById("unknown_token_error");
      resumeButton.onclick = function (event) {
        location.href = WEB_ROOT + "next.html?token=" + resumeToken;
      };

      resumeButton.onkeydown = function (event) {
        var charCode =
          typeof event.which === "number" ? event.which : event.keyCode;
        if (ACTION_KEYS.indexOf(charCode) === -1) return;
        location.href = WEB_ROOT + "next.html?token=" + resumeToken;
      };

      document.onkeydown = function (event) {
        event = event || window.event;
        var charCode =
          typeof event.which === "number" ? event.which : event.keyCode;

        if (ACTION_KEYS.indexOf(charCode) !== -1) {
          event.preventDefault();
          var tabbables = document.getElementsByClassName("tabbable");
          var element = tabbables[selectedTabbable];
          if (!element) return;
          if (element.type === "checkbox") {
            element.checked = !element.checked;
          } else {
            element.click();
          }
        }

        if (PREV_KEYS.indexOf(charCode) !== -1) {
          focusPrevious();
        }

        if (NEXT_KEYS.indexOf(charCode) !== -1) {
          focusNext();
        }
      };

      var lifeTime = 30 * 60 * 1000; // 30min
      WaveService.createSession(
        { expirationDate: new Date().getTime() + lifeTime },
        function (token) {
          var sessionTokenElement = document.getElementById("session-token");
          sessionTokenElement.innerText = token;

          WaveService.readSessionStatus(token, function (config) {
            var expiaryDateElement = document.getElementById("expiary-date");
            expiaryDateElement.innerText = config.expirationDate.toLocaleString();
          });

          var configurationUrl =
            location.origin +
            WEB_ROOT +
            "configuration.html?token=" +
            token +
            "&resume=" +
            resumeToken;
          new QRCode(document.getElementById("qr-code"), configurationUrl);
          document.getElementById("configure-button").onclick = function () {
            window.open(configurationUrl, "_blank");
          };

          WaveService.addSessionEventListener(token, function (message) {
            if (message.type === "resume") {
              var resumeToken = message.data;
              location.href = WEB_ROOT + "next.html?token=" + resumeToken;
            }

            if (message.type !== "status") return;
            if (message.data === "pending") return;
            location.href = WEB_ROOT + "next.html?token=" + token;
          });
        }
      );
      document.getElementById("resume-button").focus();
    </script>
    <script src="lib/eula.js"></script>
  </body>
</html>
